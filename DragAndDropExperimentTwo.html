<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title></title>


        <style>
            
            .drag {
                position: absolute;
                height: 100px;
                width: 100px;
                background-color: red;
            }
        </style>

    </head>
    <body>

        <div id="debug"></div>


        <div class="drag"></div>
            <div class="drag"></div>
            <div class="drag"></div>
            <div class="drag"></div>


<script>
    var startX = 0;
    var startY = 0;
    var offsetX = 0;
    var offsetY = 0;
    var dragElement = null;
    var oldZIndex = 0;
    var debug = $('debug');

    InitDragDrop();

    function InitDragDrop() {
        document.onmousedown = OnMouseDown;
        document.onmouseup = OnMouseUp;
    }

    function OnMouseDown(e) {
        console.log('mouse down');
        if (e == null)
            e = window.event;

        var target = e.target != null ? e.target : e.srcElement;

        debug.innerHTML = target.className == 'drag' ? 'draggable element clicked' : 'Non-draggable element clicked';

        if ((e.button == 1 && window.event != null || e.button == 0) && target.className == 'drag') {
            startX = e.clientX;
            startY = e.clientY;

            offsetX = ExtractNumber(target.style.left);
            offsetY = ExtractNumber(target.style.top);

            oldZIndex = target.style.zIndex;
            target.style.zIndex = 100000;

            dragElement = target;


            document.onmousemove = OnMouseMove;

            document.body.focus();

            document.onselectstart = function () {
                return false;
            }

            target.onsdragstart = function () { return false; }

            return false;

        }
    }

    function OnMouseMove(e) {
        if (e == null)
            var e = window.event;


        console.log('mouse moving');
        dragElement.style.left = (offsetX + e.clientX - startX) + 'px';
        dragElement.style.top = (offsetY + e.clientY - startY) + 'px';

        debug.innerHTML = '(' + dragElement.style.left + ', ' + dragElement.style.top + ')';
    }

    function OnMouseUp(e) {
        if (dragElement != null) {
            dragElement.style.zIndex = oldZIndex;

            document.onmousemove = null;
            document.onselectstart = null;
            dragElement.ondragstart = null;

            dragElement = null;

            debug.innerHTML = 'mousr up';
        }
    }

    function ExtractNumber(value) {
        var n = parseInt(value);
        return n == null || isNaN(n) ? 0 : n;
    }

    function $(id) {
        return document.getElementById(id);
    }


</script>



        
    </body>
</html>


